<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© | Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¨Ø¦Ø© Ùˆ Ø·Ø¨Ø§Ø¹Ø©</title>
  <style>
    :root{
      --brand:#0ea5e9;
      --ink:#111827;
      --muted:#6b7280;
      --bg:#f8fafc;
      --paper:#ffffff;
      --grid:#e5e7eb;
      --holiday:#d1fae5;
      --holidayText:#065f46;
      --note:#fee2e2;
      --noteText:#7f1d1d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: "Tajawal", Tahoma, "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      margin:0;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    .wrap{ max-width: 1220px; margin: 24px auto; padding: 0 16px; }
    .card{ background: var(--paper); border:1px solid var(--grid); border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,.04); overflow: hidden; }
    .toolbar{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      padding: 14px 16px; background: linear-gradient(90deg, rgba(14,165,233,.08), rgba(14,165,233,.02));
      border-bottom:1px solid var(--grid);
    }
    .title{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; flex-direction: row-reverse; }
    .title h1{ font-size: 20px; margin:0; letter-spacing:.2px; }
    .logo{ height:56px; width:auto; object-fit:contain; border:1px solid var(--grid); background:#fff; border-radius:10px; padding:6px; }
    .badge{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px;
      border:1px solid var(--grid); border-radius: 10px; background:#fff; font-size:14px; color:var(--muted);
    }
    .controls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .btn{
      appearance:none; border:1px solid var(--grid); background:#fff; padding:10px 14px; border-radius:10px; cursor:pointer;
      font-size:14px; line-height:1; display:inline-flex; align-items:center; gap:8px; transition:.2s ease;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.05) }
    .btn.primary{ background:var(--brand); border-color:var(--brand); color:#fff }
    .btn.ghost{ background:transparent }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; box-shadow:none }
    .grid{ padding: 16px; display:grid; grid-template-columns: repeat(6, 1fr); gap:10px; border-bottom:1px dashed var(--grid); }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field label{ font-size:12px; color:var(--muted); }
    .input{ width:100%; border:1px solid var(--grid); border-radius:10px; padding:10px 12px; font-size:14px; background:#fff; outline:none; }
    .input:focus{ border-color:var(--brand); box-shadow:0 0 0 3px rgba(14,165,233,.15) }
    .tablewrap{ padding: 10px 16px 16px }
    table{ width:100%; border-collapse:collapse; table-layout:fixed; border:1px solid var(--grid); border-radius:12px; overflow:hidden; }
    thead th{ background:rgba(14,165,233,.06); color:#0b3b4f; border-bottom:1px solid var(--grid); padding:10px; font-size:14px; text-align:center; }
    tbody td{ border-top:1px solid var(--grid); padding:0; vertical-align:top; }
    .day{ background:#fff; text-align:center; font-weight:700; font-size:14px; padding:12px !important; color:#0b3b4f; position:relative; }
    .day .tag{ position:absolute; left:8px; top:8px; background:var(--holiday); color:var(--holidayText); border:1px solid #a7f3d0; border-radius:8px; padding:2px 6px; font-size:11px; display:none; }
    .cell{ padding:6px; }
    .date-input{ width:100%; border: none; padding:10px 12px; font-size:14px; line-height:1.4; background:transparent; outline:none; border-bottom:1px dashed var(--grid); }
    textarea, input[type="text"]{ width:100%; border: none; padding:10px 12px; font-size:14px; line-height:1.5; background:transparent; resize:vertical; min-height:44px; outline:none; }
    textarea:focus, input[type="text"]:focus{ box-shadow: inset 0 -2px 0 0 var(--brand); }
    .holiday{ background: var(--holiday); }
    .footnote{ padding: 10px 16px 16px; color:var(--muted); display:flex; justify-content:space-between; align-items:center; gap:10px; font-size:12px; flex-wrap:wrap; }
    .brandline{ color:#0b3b4f; font-weight:600 }
    .weeknote{ background: var(--note); color: var(--noteText); border:1px solid #fecaca; padding:6px 10px; border-radius:8px; display:none; }
    colgroup col:nth-child(1){width:11%} colgroup col:nth-child(2){width:12%} colgroup col:nth-child(3){width:25%} colgroup col:nth-child(4){width:24%} colgroup col:nth-child(5){width:20%} colgroup col:nth-child(6){width:8%}
    @media print{
      .no-print{display:none !important} body{background:#fff} .wrap{margin:0;max-width:none;padding:0} .card{border:none;border-radius:0;box-shadow:none}
      .toolbar{border:none;background:#fff;padding:0 0 8px} .badge{border-color:#000} .grid{border:none;padding:0 0 8px} .tablewrap{padding:0}
      thead th{background:#e5f3fb !important;color:#000 !important;-webkit-print-color-adjust:exact; print-color-adjust: exact;}
      @page{ size: A4 landscape; margin: 10mm; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="sheet">
      <div class="toolbar">
        <div class="title">
          <h1>Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© â€“ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
            <select id="week" class="btn ghost" style="padding:6px 10px">
              <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
              <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
              <option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option>
              <option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option>
            </select>
          </h1>
          <span class="badge">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ: 
            <select id="term" class="btn ghost" style="padding:6px 10px">
              <option value="Ø§Ù„Ø£ÙˆÙ„">Ø§Ù„Ø£ÙˆÙ„</option><option value="Ø§Ù„Ø«Ø§Ù†ÙŠ">Ø§Ù„Ø«Ø§Ù†ÙŠ</option><option value="Ø§Ù„Ø«Ø§Ù„Ø«">Ø§Ù„Ø«Ø§Ù„Ø«</option>
            </select>
          </span>
          <span class="badge">Ø§Ù„Ø¹Ø§Ù…: <input id="year" class="input" style="padding:4px 8px;width:90px" value="1447Ù‡Ù€" /></span>
          <span class="badge">ØµÙŠØºØ© Ø§Ù„ØªØ§Ø±ÙŠØ®:
            <select id="dateMode" class="btn ghost" style="padding:6px 10px">
              <option value="hijri" selected>Ù‡Ø¬Ø±ÙŠ</option>
              <option value="greg">Ù…ÙŠÙ„Ø§Ø¯ÙŠ</option>
            </select>
          </span>
          <img class="logo" src="https://j.top4top.io/p_35129x4t01.png" alt="Ø´Ø¹Ø§Ø±" />
        </div>
        <div class="controls no-print">
          <button class="btn" id="fillBtn" title="ØªØ¹Ø¨Ø¦Ø© ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§">ğŸ“… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</button>
          <button class="btn" id="lockBtn" title="Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„ØªØ­Ø±ÙŠØ±">ğŸ”’ Ù‚ÙÙ„ Ø§Ù„ØªØ­Ø±ÙŠØ±</button>
          <button class="btn" id="clearBtn" title="ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„">ğŸ§¹ ØªÙØ±ÙŠØº</button>
          <button class="btn primary" id="printBtn" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
        </div>
      </div>

      <div class="grid">
        <div class="field"><label>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label><input class="input" id="school" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" /></div>
        <div class="field"><label>Ø§Ù„Ù…Ø¹Ù„Ù…/Ù€Ø©</label><input class="input" id="teacher" placeholder="Ø§Ù„Ø§Ø³Ù…" /></div>
        <div class="field"><label>Ø§Ù„Ù…Ø§Ø¯Ø©</label><input class="input" id="subject" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª" /></div>
        <div class="field"><label>Ø§Ù„ØµÙ</label><input class="input" id="grade" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø§Ø¯Ø³" /></div>
        <div class="field"><label>Ø§Ù„Ø´Ø¹Ø¨Ø©</label><input class="input" id="section" placeholder="Ù…Ø«Ø§Ù„: Ø£" /></div>
        <div class="field"><label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</label><input class="input" id="general" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" /></div>
      </div>

      <div class="tablewrap">
        <table aria-label="Ø¨Ø·Ø§Ù‚Ø© Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©">
          <colgroup><col /><col /><col /><col /><col /><col /></colgroup>
          <thead><tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø³</th><th>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¹Ù„Ù…ÙŠ</th><th>Ø§Ù„Ù…Ù‡Ø§Ù… / Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead>
          <tbody id="rows">
            <tr><td class="day">Ø§Ù„Ø£Ø­Ø¯ <span class="tag">Ø¥Ø¬Ø§Ø²Ø©</span></td><td class="cell"><input class="date-input" type="text" /></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø³..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¹Ù„Ù…ÙŠ..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª..."></textarea></td><td class="cell"><textarea placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea></td></tr>
            <tr><td class="day">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† <span class="tag">Ø¥Ø¬Ø§Ø²Ø©</span></td><td class="cell"><input class="date-input" type="text" /></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø³..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¹Ù„Ù…ÙŠ..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª..."></textarea></td><td class="cell"><textarea placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea></td></tr>
            <tr><td class="day">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ <span class="tag">Ø¥Ø¬Ø§Ø²Ø©</span></td><td class="cell"><input class="date-input" type="text" /></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø³..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¹Ù„Ù…ÙŠ..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª..."></textarea></td><td class="cell"><textarea placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea></td></tr>
            <tr><td class="day">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ <span class="tag">Ø¥Ø¬Ø§Ø²Ø©</span></td><td class="cell"><input class="date-input" type="text" /></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø³..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¹Ù„Ù…ÙŠ..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª..."></textarea></td><td class="cell"><textarea placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea></td></tr>
            <tr><td class="day">Ø§Ù„Ø®Ù…ÙŠØ³ <span class="tag">Ø¥Ø¬Ø§Ø²Ø©</span></td><td class="cell"><input class="date-input" type="text" /></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø³..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ¹Ù„Ù…ÙŠ..."></textarea></td><td class="cell"><textarea placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª..."></textarea></td><td class="cell"><textarea placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea></td></tr>
          </tbody>
        </table>
      </div>

      <div class="footnote">
        <div class="brandline">ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø© :Ø§/ÙØ§Ø·Ù…Ø© Ù‡Ø²Ø§Ø²ÙŠ , Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù…Ù„ØªÙ‚Ù‰ Ù…Ø¹Ù„Ù…ÙŠ Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
        <div class="weeknote" id="weeknote"></div>
        <div>Ù†ØµÙŠØ­Ø© Ø·Ø¨Ø§Ø¹Ø©: Ø§Ø®ØªØ± Ø­Ø¬Ù… Ø§Ù„ÙˆØ±Ù‚ A4 (ÙˆØ¶Ø¹ Ø£ÙÙ‚ÙŠ) Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.</div>
      </div>
    </div>
  </div>

  <script>
    // Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠØ© (2025/08 â†’ 2026/01)
    const WEEKS_GREG = {
      1:  ['24/8','25/8','26/8','27/8','28/8'],
      2:  ['31/8','1/9','2/9','3/9','4/9'],
      3:  ['7/9','8/9','9/9','10/9','11/9'],
      4:  ['14/9','15/9','16/9','17/9','18/9'],
      5:  ['21/9','22/9','23/9','24/9','25/9'],
      6:  ['28/9','29/9','30/9','1/10','2/10'],
      7:  ['5/10','6/10','7/10','8/10','9/10'],
      8:  ['12/10','13/10','14/10','15/10','16/10'],
      9:  ['19/10','20/10','21/10','22/10','23/10'],
      10: ['26/10','27/10','28/10','29/10','30/10'],
      11: ['2/11','3/11','4/11','5/11','6/11'],
      12: ['9/11','10/11','11/11','12/11','13/11'],
      13: ['16/11','17/11','18/11','19/11','20/11'],
      14: ['30/11','1/12','2/12','3/12','4/12'],
      15: ['7/12','8/12','9/12','10/12','11/12'],
      16: ['14/12','15/12','16/12','17/12','18/12'],
      17: ['21/12','22/12','23/12','24/12','25/12'],
      18: ['28/12','29/12','30/12','31/12','1/1'],
      19: ['4/1','5/1','6/1','7/1','8/1'],
    };
    // Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø­Ø³Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (0=Ø§Ù„Ø£Ø­Ø¯ .. 4=Ø§Ù„Ø®Ù…ÙŠØ³)
    const HOLIDAYS = {
      5: {2:'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', 3:'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ'},
      13:{4:'Ø¥Ø¬Ø§Ø²Ø© Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø·ÙˆÙ‘Ù„Ø©'},
    };
    const WEEK_NOTES = {
      16: 'Ø¥Ø¬Ø§Ø²Ø© Ù…Ù†ØªØµÙ Ø§Ù„ÙØµÙ„: Ù¤ Ø£ÙŠØ§Ù… Ø¨Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.',
      19: 'Ø¥Ø¬Ø§Ø²Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù… Ø§Ù„Ø®Ù…ÙŠØ³).',
    };

    const rows      = [...document.querySelectorAll('#rows tr')];
    const dateInputs= [...document.querySelectorAll('.date-input')];
    const dayTags   = [...document.querySelectorAll('.day .tag')];
    const weekSel   = document.getElementById('week');
    const noteEl    = document.getElementById('weeknote');
    const modeSel   = document.getElementById('dateMode');

    // Ø£Ø¯ÙˆØ§Øª ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
    const hijriFmtCandidates = [
      'ar-SA-u-ca-islamic-umalqura',
      'ar-SA-u-ca-islamic',
      'ar-u-ca-islamic-umalqura',
      'ar-u-ca-islamic'
    ];
    let hijriFormatter = null;
    for (const loc of hijriFmtCandidates){
      try{
        const fmt = new Intl.DateTimeFormat(loc, { day:'numeric', month:'numeric' });
        // ØªØ¬Ø±Ø¨Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù†Ù…Ø· Ø¯ÙˆÙ† Ø±Ù…ÙŠ Ø®Ø·Ø£
        fmt.format(new Date());
        hijriFormatter = fmt;
        break;
      }catch(e){}
    }
    const gregFormatter = new Intl.DateTimeFormat('ar-SA', { day:'numeric', month:'numeric' });

    function parseDM(dm){
      const [d,m] = dm.split('/').map(x=>parseInt(x,10));
      const y = (m >= 8 ? 2025 : 2026); // Ø£ØºØ³Ù€Ø·Ø³â€“Ø¯ÙŠØ³Ù…Ø¨Ø± 2025ØŒ ÙŠÙ†Ø§ÙŠØ± 2026
      return new Date(y, m-1, d);
    }
    function fmtDate(dm, mode){
      const date = parseDM(dm);
      if(mode === 'greg'){
        return gregFormatter.format(date).replace(/\s+/g,'/'); // Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ ÙØ§ØµÙ„ /
      }else{
        if(hijriFormatter){
          return hijriFormatter.format(date).replace(/\s+/g,'/');
        }else{
          // ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø¯Ø¹Ù…ØŒ Ù†ÙØ¸Ù‡Ø± Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ù…Ø¹ ØªÙ†ÙˆÙŠÙ‡ Ø¨Ø³ÙŠØ·
          return gregFormatter.format(date).replace(/\s+/g,'/') + ' (Ù…ÙŠÙ„Ø§Ø¯ÙŠ)';
        }
      }
    }

    function applyWeek(){
      const w = parseInt(weekSel.value,10);
      const mode = modeSel.value; // 'hijri' | 'greg'
      const dates = WEEKS_GREG[w];

      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
      dateInputs.forEach((inp, i)=>{
        inp.value = dates ? fmtDate(dates[i], mode) : '';
      });

      // Ù…Ø³Ø­ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©
      rows.forEach((tr)=>{ tr.classList.remove('holiday'); });
      dayTags.forEach((tag)=>{ tag.style.display='none'; tag.textContent='Ø¥Ø¬Ø§Ø²Ø©'; });

      // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
      const h = HOLIDAYS[w] || {};
      Object.keys(h).forEach(idx => {
        const i = parseInt(idx,10);
        const tr = rows[i];
        tr.classList.add('holiday');
        const tag = tr.querySelector('.tag');
        if(tag){ tag.style.display='inline-block'; tag.textContent=h[idx]; }
        dateInputs[i].value = (dateInputs[i].value || '') + ' â€” ' + h[idx];
      });

      // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø³ÙÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
      const wn = WEEK_NOTES[w];
      if(wn){ noteEl.textContent = wn; noteEl.style.display='inline-flex'; }
      else { noteEl.textContent=''; noteEl.style.display='none'; }

      // Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„
      localStorage.setItem('plan:dateMode', mode);
    }

    // Ø£Ø­Ø¯Ø§Ø«
    weekSel.addEventListener('change', applyWeek);
    modeSel.addEventListener('change', applyWeek);
    document.getElementById('fillBtn').addEventListener('click', applyWeek);

    // Ù†ØµÙˆØµ Ø£Ø®Ø±Ù‰ Ù…ÙˆØ¬ÙˆØ¯Ø© Ø³Ø§Ø¨Ù‚Ù‹Ø§
    const fit = el => { el.style.height = 'auto'; el.style.height = (el.scrollHeight+2)+'px'; }
    document.querySelectorAll('textarea').forEach(t => { fit(t); t.addEventListener('input', () => fit(t)); });
    document.getElementById('printBtn').addEventListener('click', () => window.print());
    document.getElementById('clearBtn').addEventListener('click', () => {
      if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ ØªÙØ±ÙŠØº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©ØŸ')){
        document.querySelectorAll('input[type="text"], .grid .input, textarea').forEach(el => {
          if(el.id === 'year') return;
          el.value = '';
          if(el.tagName.toLowerCase() === 'textarea') fit(el);
        });
        rows.forEach(tr=>{ tr.classList.remove('holiday'); });
        dayTags.forEach(sp=>{ sp.style.display='none'; sp.textContent='Ø¥Ø¬Ø§Ø²Ø©'; });
        noteEl.textContent=''; noteEl.style.display='none';
      }
    });
    let locked = false;
    const lockBtn = document.getElementById('lockBtn');
    lockBtn.addEventListener('click', () => {
      locked = !locked;
      document.querySelectorAll('input, textarea, select').forEach(el => {
        if(el.id === 'week' || el.id === 'term' || el.id === 'dateMode') return;
        el.disabled = locked;
      });
      lockBtn.textContent = locked ? 'ğŸ”“ ÙØªØ­ Ø§Ù„ØªØ­Ø±ÙŠØ±' : 'ğŸ”’ Ù‚ÙÙ„ Ø§Ù„ØªØ­Ø±ÙŠØ±';
      lockBtn.classList.toggle('primary', locked);
    });

    // Ø­ÙØ¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„
    const persistIds = ['school','teacher','subject','grade','section','general','term','year'];
    persistIds.forEach(id => {
      const el = document.getElementById(id);
      if(!el) return;
      const key = 'plan:'+id;
      const saved = localStorage.getItem(key);
      if(saved) el.value = saved;
      el.addEventListener('input', () => localStorage.setItem(key, el.value));
      if(el.tagName.toLowerCase()==='select'){
        el.addEventListener('change', () => localStorage.setItem(key, el.value));
      }
    });
    const weekKey = 'plan:week';
    const savedWeek = localStorage.getItem(weekKey);
    if(savedWeek) weekSel.value = savedWeek;
    weekSel.addEventListener('change', ()=> localStorage.setItem(weekKey, weekSel.value));

    const savedMode = localStorage.getItem('plan:dateMode');
    if(savedMode) modeSel.value = savedMode;

    // ØªØ¹Ø¨Ø¦Ø© Ø£ÙˆÙ„ÙŠØ©
    applyWeek();
  </script>
</body>
</html>
